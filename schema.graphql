enum TransferType {
  TRANSFER
  MINT
  BURN
}

type Transfer @index(fields: ["token", ["blockTimestamp", "DESC"]]) {
  id: ID!                    # ${chainId}_${token}_${blockNumber}_${logIndex}
  chainId: Int!
  token: String!
  blockNumber: Int!
  blockTimestamp: Int!
  logIndex: Int!
  txHash: String! @index
  from: String!
  to: String!
  value: BigInt!
  transferType: TransferType!
}

type Account @index(fields: ["token", ["balance", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${address}
  chainId: Int!
  token: String!
  address: String! @index
  balance: BigInt!
  totalVolumeIn: BigInt!
  totalVolumeOut: BigInt!
  transfersIn: Int!
  transfersOut: Int!
  firstSeenBlock: Int!
  firstSeenTimestamp: Int!
  lastActiveBlock: Int!
  lastActiveTimestamp: Int!
}

type TokenSupply @index(fields: ["chainId", "token"]) {
  id: ID!                    # ${chainId}-${token}-supply
  chainId: Int!
  token: String!
  totalSupply: BigInt!
  totalMinted: BigInt!
  totalBurned: BigInt!
  allTimeVolume: BigInt!
  holderCount: Int!
  mintCount: Int!
  burnCount: Int!
  transferCount: Int!
  lastUpdatedBlock: Int!
  lastUpdatedTimestamp: Int!
}

type HourlySnapshot @index(fields: ["token", ["hourId", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${hourId}
  chainId: Int!
  token: String!
  hourId: Int!
  hourStartTimestamp: Int!
  volume: BigInt!
  transferCount: Int!
  mintVolume: BigInt!
  burnVolume: BigInt!
  netMintBurnFlow: BigInt!
  mintCount: Int!
  burnCount: Int!
  endOfHourSupply: BigInt!
  firstBlockOfHour: Int!
  lastBlockOfHour: Int!
}

type DailySnapshot @index(fields: ["token", ["dayId", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${dayId}
  chainId: Int!
  token: String!
  dayId: Int!
  dayStartTimestamp: Int!
  dailyVolume: BigInt!
  dailyTransferCount: Int!
  dailyMintVolume: BigInt!
  dailyBurnVolume: BigInt!
  netMintBurnFlow: BigInt!
  dailyMintCount: Int!
  dailyBurnCount: Int!
  uniqueActiveAddresses: Int!
  newAddressCount: Int!
  endOfDaySupply: BigInt!
  velocity: BigDecimal! @config(precision: 30, scale: 15)
  firstBlockOfDay: Int!
  lastBlockOfDay: Int!
}

type WeeklySnapshot @index(fields: ["token", ["weekId", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${weekId}
  chainId: Int!
  token: String!
  weekId: Int!
  weekStartTimestamp: Int!
  weeklyVolume: BigInt!
  weeklyTransferCount: Int!
  weeklyMintVolume: BigInt!
  weeklyBurnVolume: BigInt!
  netMintBurnFlow: BigInt!
  weeklyMintCount: Int!
  weeklyBurnCount: Int!
  uniqueActiveAddresses: Int!
  endOfWeekSupply: BigInt!
  velocity: BigDecimal! @config(precision: 30, scale: 15)
  firstBlockOfWeek: Int!
  lastBlockOfWeek: Int!
}

type CrossTokenDailySnapshot @index(fields: ["chainId", ["dayId", "DESC"]]) {
  id: ID!                    # ${chainId}-${dayId}
  chainId: Int!
  dayId: Int!
  dayStartTimestamp: Int!
  totalVolume: BigInt!
  totalTransferCount: Int!
  totalMintVolume: BigInt!
  totalBurnVolume: BigInt!
  netMintBurnFlow: BigInt!
}

type AccountBalanceSnapshot @index(fields: ["account", "token", ["blockTimestamp", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${address}-${blockNumber}-${logIndex}
  chainId: Int!
  token: String!
  account: String!
  blockNumber: Int!
  blockTimestamp: Int!
  balance: BigInt!
  balanceChange: BigInt!
  txHash: String!
}

type AccountDailyActivity @index(fields: ["account", "token", ["dayId", "DESC"]]) {
  id: ID!                    # ${chainId}-${token}-${address}-${dayId}
  chainId: Int!
  token: String!
  account: String!
  dayId: Int!
  transferCount: Int!
  volumeIn: BigInt!
  volumeOut: BigInt!
}

# Marker entities for unique address deduplication per period
type DailyActiveAddress {
  id: ID!                    # ${chainId}-${token}-${dayId}-${address}
}

type WeeklyActiveAddress {
  id: ID!                    # ${chainId}-${token}-${weekId}-${address}
}
